<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å°¾ç‰™éŠæˆ²</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Noto Sans TC', sans-serif;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .game-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .title {
            font-size: 1.75rem;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 1rem;
        }

        .input-group {
            margin: 1.5rem 0;
        }

        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .button {
            background-color: #4a5568;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .button:hover {
            background-color: #2d3748;
        }

        .rules-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .rules-title {
            font-size: 1.25rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .rules-list {
            list-style: none;
            padding: 0;
        }

        .rules-list li {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .rules-list li:before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #4a5568;
        }

        .question-modal {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .question-title {
            font-size: 1.25rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .choice-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .choice-button {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            background: #f8f9fa;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.2s;
        }

        .choice-button:hover {
            background: #4a5568;
            color: white;
        }

        .game-screen {
            display: none;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .node {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            text-align: center;
            padding: 0.5rem;
            min-height: 60px;
            position: relative;
        }

        .game-info {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .info-item {
            margin: 0.5rem 0;
            text-align: center;
        }

        .dice-container {
            text-align: center;
            margin: 1rem 0;
        }

        .dice-face {
            width: 60px;
            height: 60px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            padding: 8px;
            margin: 1rem auto;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #4a5568;
            border-radius: 50%;
            margin: auto;
        }

        .player {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #e53e3e;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        @media (max-width: 640px) {
            .container {
                padding: 1rem;
                margin: 1rem;
            }

            .node {
                min-height: 40px;
                padding: 0.25rem;
                font-size: 0.75rem;
            }
        }
        .wish-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 400px;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .wish-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .wish-input {
            width: 100%;
            min-height: 100px;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            resize: none;
        }

        .wish-submit {
            background-color: #4a5568;
            color: white;
            padding: 0.75rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .wish-submit:hover {
            background-color: #2d3748;
        }

        .hidden-node {
            visibility: hidden;
            background: transparent;
            border: none;
        }

        .node.corner {
            background: #8b5cf6;
            color: white;
        }

        .node[data-category="æŠ€è¡“"] { background: #60a5fa; }
        .node[data-category="ç”Ÿæ´»"] { background: #34d399; }
        .node[data-category="äººç‰©"] { background: #f472b6; }
        .node[data-category="æ™‚äº‹"] { background: #fbbf24; }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-card">
            <h1 class="title">2025å°¾ç‰™éŠæˆ²</h1>
            
            <div class="input-group">
                <label class="input-label">ç©å®¶åç¨±</label>
                <input type="text" id="name" class="input-field" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—">
                <button class="button" id="startGame">é–‹å§‹éŠæˆ²</button>
            </div>

            <div class="rules-section">
                <h2 class="rules-title">éŠæˆ²è¦å‰‡</h2>
                <ul class="rules-list">
                    <li>ç©å®¶å¾èµ·é»é–‹å§‹ï¼Œæ“²éª°å­æ±ºå®šå‰é€²æ­¥æ•¸</li>
                    <li>è½åœ¨å•ç­”æ ¼éœ€å›ç­”è©²é¡åˆ¥é¡Œç›®ï¼šç­”å°+10åˆ†ï¼Œç­”éŒ¯-10åˆ†</li>
                    <li>å¯é¸æ“‡è·³éå›ç­”ï¼Œä½†æœƒæ‰£10åˆ†</li>
                    <li>ç‰¹æ®Šè§’è½å¯ç²å¾—50åˆ†</li>
                    <li>ç¹å®Œä¸€åœˆå³å¯çµæŸéŠæˆ²</li>
                </ul>
            </div>
        </div>

        <div class="game-screen">
            <div class="board" id="board"></div>
            <div class="game-info">
                <div class="info-item">
                    åˆ†æ•¸ï¼š<span id="score">100</span>
                </div>
                <div class="info-item">
                    æ“²éª°çµæœï¼š<span id="diceResult">-</span>
                </div>
                <div class="dice-container">
                    <div class="dice-face" id="diceFace"></div>
                    <button class="button" id="rollDice">æ“²éª°</button>
                </div>
            </div>
        </div>

        <div id="questionContainer" class="question-modal" style="display: none;">
            <h2 id="questionText" class="question-title">å•é¡Œ</h2>
            <div id="options" class="choice-buttons"></div>
        </div>

        <div id="choiceContainer" class="question-modal" style="display: none;">
            <h2 class="question-title">æ˜¯å¦ç­”é¡Œï¼Ÿ</h2>
            <div class="choice-buttons">
                <button id="answerButton" class="choice-button">ç­”é¡Œ</button>
                <button id="passButton" class="choice-button">è·³é (-10åˆ†)</button>
            </div>
        </div>

        <!-- é¡˜æœ›ç‰† -->
        <div class="modal-overlay" id="wishOverlay"></div>
        <div class="wish-modal" id="wishModal">
            <h2 class="title">ğŸŒŸ æ–°å¹´ç¥ç¦ 2025 ğŸŒŸ</h2>
            <form class="wish-form" id="wishForm">
                <textarea class="wish-input" placeholder="åœ¨é€™è£¡å¯«ä¸‹ä½ çš„æ–°å¹´æœŸè¨±æˆ–ç¥ç¦..." maxlength="200" required></textarea>
                <button type="submit" class="wish-submit">é€å‡ºç¥ç¦</button>
            </form>
        </div>
    </div>
    <script>
        // Google Apps Script ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€
const googleAppsScriptUrl = 'https://script.google.com/macros/s/AKfycbywP4H7lBXRaSjXG-IxbWx_5qf7Z24XgGqAkd-d8U6Qrwkli0HShRA6ypIrt19E1akcSA/exec'; // æ›¿æ›ç‚ºæ‚¨çš„ç¶²å€

// å‚³é€éŠæˆ²çµæœåˆ° Google Sheets çš„å‡½å¼
// ä¿®æ­£å¾Œçš„ sendGameResult å‡½æ•¸
function sendGameResult(playerName, score, wish) {
    // ç¢ºä¿æ‰€æœ‰åƒæ•¸éƒ½ç¶“éæ­£ç¢ºç·¨ç¢¼
    const encodedParams = new URLSearchParams({
        playerName: encodeURIComponent(playerName),
        score: encodeURIComponent(score),
        wish: encodeURIComponent(wish || '')
    });

    const url = `${googleAppsScriptUrl}?${encodedParams.toString()}`;
    console.log('ç™¼é€è«‹æ±‚:', url);

    fetch(url)
        .then(response => {
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
        })
        .then(data => {
            console.log('å›æ‡‰:', data);
            if (data.status === 'success') {
                saveToHistory(playerName, score);
                alert('éŠæˆ²ç´€éŒ„å·²æˆåŠŸå„²å­˜ï¼');
            } else {
                throw new Error(data.message || 'å„²å­˜å¤±æ•—');
            }
        })
        .catch(error => {
            console.error('éŒ¯èª¤:', error);
            alert(`å„²å­˜å¤±æ•—: ${error.message}`);
        });
}

        const board = document.getElementById('board');
        const gameControls = document.getElementById('gameControls');
        const scoreDisplay = document.getElementById('score');
        const diceResultDisplay = document.getElementById('diceResult');
        const rollDiceButton = document.getElementById('rollDice');
        const nameInput = document.getElementById('name');
        const Button = document.getElementById('');
        const scoreboardTable = document.getElementById('scoreboard');
        const historyTable = document.getElementById('history');
        const questionContainer = document.getElementById('questionContainer');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('options');
        const diceFace = document.getElementById('diceFace');
      const choiceContainer = document.getElementById('choiceContainer');
const answerButton = document.getElementById('answerButton');
const passButton = document.getElementById('passButton');

document.getElementById('startGame').addEventListener('click', () => {
            playerName = nameInput.value.trim();
            
            if (!playerName || playerName.length > 20 || !/^[\w\u4e00-\u9fa5]+$/.test(playerName)) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„åå­—ï¼ˆ20 å­—ä»¥å…§ï¼Œåƒ…åŒ…å«å­—æ¯ã€æ•¸å­—æˆ–ä¸­æ–‡ï¼‰ï¼");
                return;
            }
            
            document.querySelector('.game-card').style.display = 'none';
            document.querySelector('.game-screen').style.display = 'block';
            
            createNodes();
            updatePlayerPosition();
            updateDiceFace(1);
        });
        
// ç©å®¶é¸æ“‡ç­”é¡Œ
answerButton.addEventListener('click', () => {
    choiceContainer.style.display = "none"; // éš±è—é¸æ“‡è¦–çª—
    askQuestion(playerPosition); // å‘¼å«é¡Œç›®é¡¯ç¤ºå‡½æ•¸
});

// ç©å®¶é¸æ“‡è·³é
passButton.addEventListener('click', () => {
    choiceContainer.style.display = "none"; // éš±è—é¸æ“‡è¦–çª—
    score -= 10; // æ‰£é™¤10åˆ†
    scoreDisplay.textContent = score; // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
    rollDiceButton.disabled = false; // å•Ÿç”¨éª°å­æŒ‰éˆ•
});

        let playerName = ""; // æ–°å¢å…¨åŸŸè®Šé‡        
        let score = 100;
        let playerPosition = 0;
        let totalNodesTravelled = 0;
        const totalNodes = 28;
        let completedLaps = 0; // æ–°å¢è®Šæ•¸ï¼Œè¿½è¹¤å®Œæˆçš„è¿´åœˆæ•¸
        let isGameOver = false; // æ–°å¢è®Šæ•¸ï¼ŒéŠæˆ²æ˜¯å¦çµæŸ
        const questions = {
        æŠ€è¡“: [
        { text: "HTML æ˜¯ä»€éº¼çš„ç¸®å¯«ï¼Ÿ", options: ["Hyper Text Markup Language", "Hyperlink and Text Module", "Home Tool Markup Language"], answer: "Hyper Text Markup Language" },
        { text: "JavaScript æ˜¯ä¸€ç¨®ä»€éº¼èªè¨€ï¼Ÿ", options: ["éœæ…‹èªè¨€", "å‹•æ…‹èªè¨€", "æ¨™è¨˜èªè¨€"], answer: "å‹•æ…‹èªè¨€" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ1", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ2", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ3", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ4", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ5", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ6", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ7", options: ["A", "B", "C"], answer: "A" },
        { text: "æŠ€è¡“æ¸¬è©¦é¡Œ8", options: ["A", "B", "C"], answer: "A" },
        ],
        ç”Ÿæ´»: [
        { text: "æ—©é¤ä¸åƒæœƒå°èº«é«”é€ æˆä»€éº¼å½±éŸ¿ï¼Ÿ", options: ["å¢åŠ æ–°é™³ä»£è¬", "é™ä½è¡€ç³–", "æ²’æœ‰å½±éŸ¿"], answer: "é™ä½è¡€ç³–" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ1", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ2", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ3", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ4", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ5", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ6", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ7", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ8", options: ["A", "B", "C"], answer: "A" },
        { text: "ç”Ÿæ´»æ¸¬è©¦é¡Œ9", options: ["A", "B", "C"], answer: "A" },
        ],
        äººç‰©: [
        { text: "æ„›å› æ–¯å¦æœ€è‘—åçš„ç†è«–æ˜¯ä»€éº¼ï¼Ÿ", options: ["é‡å­åŠ›å­¸", "ç›¸å°è«–", "ç†±åŠ›å­¸"], answer: "ç›¸å°è«–" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ1", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ2", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ3", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ4", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ5", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ6", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ7", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ8", options: ["A", "B", "C"], answer: "A" },
        { text: "äººç‰©æ¸¬è©¦é¡Œ9", options: ["A", "B", "C"], answer: "A" },
        ],
        æ™‚äº‹: [
        { text: "2025 å¹´ä¸–ç•Œçš„æœ€æ–°ç§‘æŠ€è¶¨å‹¢æ˜¯ä»€éº¼ï¼Ÿ", options: ["äººå·¥æ™ºæ…§", "é‡å­è¨ˆç®—", "å€å¡Šéˆ"], answer: "äººå·¥æ™ºæ…§" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ1", options: ["A", "B", "C"], answer: "A" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ2", options: ["A", "B", "C"], answer: "B" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ3", options: ["A", "B", "C"], answer: "A" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ4", options: ["A", "B", "C"], answer: "C" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ5", options: ["A", "B", "C"], answer: "A" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ6", options: ["A", "B", "C"], answer: "A" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ7", options: ["A", "B", "C"], answer: "A" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ8", options: ["A", "B", "C"], answer: "C" },
        { text: "æ™‚äº‹æ¸¬è©¦é¡Œ9", options: ["A", "B", "C"], answer: "B" },
        ],
    };
        const loadHistory = () => {
            try {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];
                historyTable.innerHTML = "";
                history.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${record.name}</td><td>${record.score}</td><td>${record.time}</td>`;
                    historyTable.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading history: ", error);
            }
        };

        const saveToHistory = (playerName, score) => {
            try {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];
                const time = new Date().toLocaleString();
                history.push({ name: playerName, score, time });
                localStorage.setItem('gameHistory', JSON.stringify(history));
            } catch (error) {
                console.error("Error saving to history: ", error);
            }
        };

      function adjustBoardSize() {
    const board = document.querySelector('.board');
    const nodes = document.querySelectorAll('.node');
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    const smallerDimension = Math.min(viewportWidth, viewportHeight);

    // èª¿æ•´åœ°åœ–å®¹å™¨å¤§å°
    const boardSize = smallerDimension * 0.9; // åœ°åœ–å®¹å™¨å è¢å¹•çš„ 90%
    board.style.width = `${boardSize}px`;
    board.style.height = `${boardSize}px`;

    // è¨ˆç®—æ¯å€‹ç¯€é»çš„å¤§å°
    const gridSize = Math.sqrt(nodes.length); // å‡è¨­ç¯€é»æ˜¯æ­£æ–¹å½¢æ’åˆ—
    const nodeSize = boardSize / gridSize; // ç¯€é»å¤§å° = å®¹å™¨å¤§å° / æ ¼æ•¸
    nodes.forEach(node => {
        node.style.width = `${nodeSize}px`;
        node.style.height = `${nodeSize}px`;
        node.style.fontSize = `${nodeSize / 5}px`; // èª¿æ•´æ–‡å­—å¤§å°
    });
}

// ç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚åŸ·è¡Œ
window.addEventListener('resize', adjustBoardSize);

// é é¢åŠ è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡
adjustBoardSize();

const specialCorners = []; // å„²å­˜ç‰¹æ®Šè§’è½çš„ç´¢å¼•

function createNodes() {
    // æ¸…ç©ºç¾æœ‰çš„board
    board.innerHTML = '';
    
    for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
            const node = document.createElement('div');
            const isEdge = (i === 0 || i === 7 || j === 0 || j === 7);
            const isCorner = (i === 0 && j === 0) || (i === 0 && j === 7) || 
                           (i === 7 && j === 0) || (i === 7 && j === 7);

            if (isCorner) {
                node.classList.add('node', 'corner');
                node.textContent = 'ç‰¹æ®Šè§’è½';
                node.dataset.name = 'ç‰¹æ®Šè§’è½';
                
                const cornerIndex = calculateNodeIndex(i, j);
                node.dataset.index = cornerIndex;
                specialCorners.push(cornerIndex);
            } else if (isEdge) {
                node.classList.add('node', 'path');
                const nodeIndex = calculateNodeIndex(i, j);
                const categoryNames = ['æŠ€è¡“', 'ç”Ÿæ´»', 'äººç‰©', 'æ™‚äº‹'];
                const category = categoryNames[nodeIndex % 4];
                node.dataset.category = category;
                node.dataset.name = category;
                node.textContent = category;
                node.dataset.index = nodeIndex;
            } else {
                node.classList.add('node', 'hidden-node');
            }

            board.appendChild(node);
        }
    }
}

function adjustNodeStyles() {
    const isSmallScreen = window.innerWidth < 600;
    const nodes = document.querySelectorAll('.node');
    nodes.forEach(node => {
        if (isSmallScreen) {
            node.style.fontSize = "10px"; /* ç¸®å°æ–‡å­— */
            node.style.padding = "2px";  /* æ¸›å°‘ç¯€é»é‚Šè· */
        } else {
            node.style.fontSize = "14px"; /* æ¢å¾©é è¨­å¤§å° */
            node.style.padding = "5px";
        }
    });
}

// ç•¶ä½¿ç”¨è€…æ”¹è®Šè£ç½®å°ºå¯¸æ™‚è§¸ç™¼
window.addEventListener('resize', adjustNodeStyles);

// é é¢åŠ è¼‰æ™‚ç«‹å³æª¢æŸ¥ä¸€æ¬¡
adjustNodeStyles();

// ä¿®æ”¹ç¯€é»ç´¢å¼•è¨ˆç®—å‡½æ•¸
        function calculateNodeIndex(row, col) {
            if (row === 0) return col;                    // é ‚éƒ¨è¡Œ
            if (col === 7) return 7 + row;                // å³å´åˆ—
            if (row === 7) return 21 - col;               // åº•éƒ¨è¡Œ
            if (col === 0) return 28 - row;               // å·¦å´åˆ—
            return null;
        }

        function updatePlayerPosition() {
    const nodes = document.querySelectorAll('.node');
    
    // é‡ç½®æ‰€æœ‰ç¯€é»çš„å…§å®¹
    nodes.forEach(node => {
        const category = node.dataset.category || node.dataset.name || '';
        node.innerHTML = ''; // ç¢ºä¿å…§å®¹è¢«æ¸…ç©º
        
        // æ’å…¥é¡åˆ¥åç¨±
        const categorySpan = document.createElement('span');
        categorySpan.textContent = category;
        node.appendChild(categorySpan);
    });

    // æ‰¾åˆ°ç©å®¶æ‰€åœ¨çš„ç¯€é»
    const currentNode = [...nodes].find(node => node.dataset.index == playerPosition);
    if (currentNode) {
        const playerElement = document.createElement('div');
        playerElement.className = 'player bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold';
        playerElement.classList.add('player');
        playerElement.textContent = "P";
        currentNode.appendChild(playerElement);
    }
}

      function checkSpecialCorner(position) {
    const nodes = document.querySelectorAll('.node');
    const currentNode = [...nodes].find(node => node.dataset.index == position);

    if (currentNode && currentNode.classList.contains('corner')) {
        handleSpecialCorner(currentNode.dataset.name);
    }
}

function handleSpecialCorner(cornerName) {
    switch (cornerName) {
        case 'ç‰¹æ®Šè§’è½':
            alert("æ­¡è¿ä¾†åˆ°ç‰¹æ®Šè§’è½ï¼ä½ ç²å¾—äº† 50 åˆ†çå‹µï¼");
            score += 50;
            break;
        default:
            alert(`ä½ é€²å…¥äº† ${cornerName}ï¼Œä½†ç›®å‰æ²’æœ‰å®šç¾©çš„è¡Œå‹•ã€‚`);
            break;
    }

    // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
    scoreDisplay.textContent = score;

    // éš±è—ã€Œæ˜¯å¦ç­”é¡Œã€å’Œå…¶ä»–ç›¸é—œè¦–çª—
    choiceContainer.style.display = "none";
    questionContainer.style.display = "none";

    // å•Ÿç”¨éª°å­æŒ‰éˆ•ï¼Œå…è¨±ç©å®¶ç¹¼çºŒéŠæˆ²
    rollDiceButton.disabled = false;
}
           
        function updateDiceFace(value) {
            const dots = [
                [],
                [4],
                [0, 8],
                [0, 4, 8],
                [0, 2, 6, 8],
                [0, 2, 4, 6, 8],
                [0, 2, 3, 5, 6, 8]
            ];
            diceFace.innerHTML = "";
            for (let i = 0; i < 9; i++) {
                const dot = document.createElement('div');
                dot.className = dots[value].includes(i) ? 'dot' : '';
                diceFace.appendChild(dot);
            }
        }

        rollDiceButton.addEventListener('click', () => {
    if (isGameOver) return;

    diceFace.classList.add('animate');
    rollDiceButton.disabled = true;

    const diceResult = Math.floor(Math.random() * 6) + 1;

    let rollingInterval = setInterval(() => {
        const randomValue = Math.floor(Math.random() * 6) + 1;
        updateDiceFace(randomValue);
    }, 100);

    setTimeout(() => {
        clearInterval(rollingInterval);
        diceFace.classList.remove('animate');
        updateDiceFace(diceResult);
        diceResultDisplay.textContent = diceResult;

        totalNodesTravelled += diceResult;

        const newLaps = Math.floor(totalNodesTravelled / totalNodes);

        if (newLaps >= 1) {
    alert("éŠæˆ²çµæŸï¼ä½ å®Œæˆäº†ä¸€å€‹å®Œæ•´è¿´åœˆï¼");
    isGameOver = true;
    handleGameEnd(); // ç§»é™¤wishåƒæ•¸çš„å‚³é
    rollDiceButton.disabled = true;
    rollDiceButton.textContent = "éŠæˆ²çµæŸ";
    return;
}

        playerPosition = (playerPosition + diceResult) % totalNodes;
        updatePlayerPosition();

        setTimeout(() => {
            if (newLaps > completedLaps) {
                completedLaps = newLaps;
                alert(`æ­å–œï¼ä½ å®Œæˆäº†ç¬¬ ${completedLaps} å€‹è¿´åœˆï¼`);
            }

            // åˆ¤æ–·æ˜¯ç‰¹æ®Šè§’è½é‚„æ˜¯æ™®é€šç¯€é»
            if (specialCorners.includes(playerPosition)) {
                handleSpecialCorner('ç‰¹æ®Šè§’è½');
            } else {
                // é¡¯ç¤ºæ˜¯å¦ç­”é¡Œçš„é¸é …
                choiceContainer.style.display = "block";
                rollDiceButton.disabled = true; // ç¦ç”¨éª°å­æŒ‰éˆ•ï¼Œç­‰å¾…ç­”é¡Œæˆ–æ‰£åˆ†
            }
        }, 500);
    }, 1000);
});

function handleGameEnd() {
    const wishModal = document.getElementById('wishModal');
    const wishOverlay = document.getElementById('wishOverlay');
    const wishForm = document.getElementById('wishForm');

    wishModal.style.display = 'block';
    wishOverlay.style.display = 'block';

    wishForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const wishText = this.querySelector('textarea').value;
        
        // ç¢ºä¿ playerName æ˜¯æœ‰æ•ˆçš„
        const finalPlayerName = playerName || nameInput.value.trim();
        if (!finalPlayerName) {
            alert('ç„¡æ³•ç²å–ç©å®¶åç¨±');
            return;
        }

        // å‚³é€çµæœ
        sendGameResult(finalPlayerName, score, wishText);
        
        // é—œé–‰æ¨¡æ…‹è¦–çª—
        wishModal.style.display = 'none';
        wishOverlay.style.display = 'none';
    });
}

        function askQuestion(position) {
    if (isGameOver) return;

    const nodes = document.querySelectorAll('.node');
    const currentNode = [...nodes].find(node => node.dataset.index == position);

    if (!currentNode) {
        console.error("ç„¡æ³•æ‰¾åˆ°ç•¶å‰ç¯€é»ï¼Œä½ç½®ï¼š", position);
        return;
    }

    const category = currentNode.dataset.category;
    if (!category) {
        console.warn("ç•¶å‰ç¯€é»æ²’æœ‰åˆ†é¡ï¼Œè·³éç­”é¡Œã€‚");
        return;
    }

    const questionPool = questions[category];
    if (!questionPool || questionPool.length === 0) {
        console.warn("ç„¡å¯ç”¨é¡Œç›®ï¼Œåˆ†é¡ï¼š", category);
        return;
    }

    const questionIndex = Math.floor(Math.random() * questionPool.length);
    const question = questionPool[questionIndex];

    questionText.textContent = question.text;
    optionsContainer.innerHTML = "";

    question.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'question-option';
        button.textContent = option;
        button.addEventListener('click', () => {
            handleAnswer(option === question.answer);
        });
        optionsContainer.appendChild(button);
    });

    questionContainer.style.display = "block";
    questionContainer.style.display = "flex";
    rollDiceButton.disabled = true;
}
      function handleAnswer(isCorrect) {
    if (isCorrect) {
        alert("ç­”å°äº†ï¼åŠ 10åˆ†ï¼");
        score += 10;
    } else {
        alert("ç­”éŒ¯äº†ï¼æ‰£10åˆ†ï¼");
        score -= 10;
    }

    // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
    scoreDisplay.textContent = score;

    // éš±è—å•é¡Œå®¹å™¨
    questionContainer.style.display = "none";

    // å•Ÿç”¨æ“²éª°æŒ‰éˆ•
    if (!isGameOver) rollDiceButton.disabled = false;
}
        
        loadHistory();
        createNodes();
        updatePlayerPosition();
        updateDiceFace(1);
    </script>
</body>
</html>

