<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å°¾ç‰™éŠæˆ²(æ¸¬è©¦ç‰ˆ)</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            background-image: url('https://png.pngtree.com/thumb_back/fh260/background/20190223/ourmid/pngtree-fresh-sweet-watercolor-soft-gradient-border-background-colorgradientsimpleframe-image_75501.jpg');
            background-size: 100vw 100vh; /* è¨­ç½®åœ–ç‰‡å¤§å°ç‚ºæ•´å€‹è¦–çª—å¯¬é«˜ */
            background-repeat: no-repeat; /* é˜²æ­¢é‡è¤‡ */
            background-position: center center; /* åœ–ç‰‡ç½®ä¸­ */
            background-attachment: fixed; /* èƒŒæ™¯å›ºå®šä¸éš¨æ»¾å‹• */
        }
        .board {
            display: grid;
            grid-template-columns: repeat(11, minmax(30px, 1fr));
            grid-template-rows: repeat(11, minmax(30px, 1fr));
            width: 90vmin;
            height: 90vmin;
            margin: 20px;
            position: relative;
            gap: 2px;
            justify-content: center;
            align-items: center;
        }
        .node {
            width: 60px; /* å¢åŠ å¯¬åº¦ */
            height: 60px; /* å¢åŠ é«˜åº¦ */
            display: flex;
            flex-direction: column; /* æ”¹ç‚ºç¸±å‘æ’åˆ— */
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 5px;
            position: relative;
            margin: 2px;
            font-size: 12px; /* èª¿æ•´å­—é«”å¤§å° */
            word-wrap: break-word; /* å…è¨±æ–‡å­—æ›è¡Œ */
            overflow: visible; /* æ”¹ç‚ºvisible */
            box-sizing: border-box;
            line-height: 1;
        }

        .node.corner {
            background-color: #ffdd57;
            font-weight: bold;
        }
        .node.path {
            background-color: #a5d8ff;
        }
        .player {
            width: 20px;
            height: 20px;
            margin-bottom: 2px;
            background-color: red;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        .controls, .scoreboard {
            text-align: center;
        }
        .button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .scoreboard {
            margin-top: 20px;
        }
        .scoreboard table {
            border-collapse: collapse;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        .scoreboard th, .scoreboard td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .scoreboard th {
            background-color: #007bff;
            color: white;
        }
        .question-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }
        .question-container h2 {
            margin-bottom: 20px;
        }
        .question-container button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        .question-container button.correct {
            background-color: #28a745;
            color: white;
        }
        .question-container button.incorrect {
            background-color: #dc3545;
            color: white;
        }
      .scoreboard, .history {
    display: none; /* éš±è—è¨ˆåˆ†ç‰ˆå’ŒéŠç©ç´€éŒ„ */
}
        .history {
            margin-top: 20px;
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        .history table {
            border-collapse: collapse;
            width: 100%;
        }
        .history th, .history td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .history th {
            background-color: #007bff;
            color: white;
        }
        .dice {
            width: 50px;
            height: 50px;
            position: relative;
            margin: 10px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .dice-face {
            width: 100%;
            height: 100%;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            position: relative;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5%;
        }
        .dot {
            width: 50%;
            height: 50%;
            background-color: #007bff;
            border-radius: 50%;
            place-self: center;
        }
        @keyframes rollDice {
            0% {
                transform: rotateX(0deg) rotateY(0deg);
            }
            25% {
                transform: rotateX(90deg) rotateY(0deg);
            }
            50% {
                transform: rotateX(90deg) rotateY(90deg);
            }
            75% {
                transform: rotateX(180deg) rotateY(90deg);
            }
            100% {
                transform: rotateX(360deg) rotateY(360deg);
            }
        }
        .dice.animate .dice-face {
            animation: rollDice 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
.node::before {
    word-wrap: break-word;
    text-align: center;
    max-width: 100%; /* è®“æ–‡å­—é™åˆ¶åœ¨ç¯€é»å¯¬åº¦å…§ */
}
      .node {
            position: relative; /* ç¢ºä¿ ::before ä»¥ç¯€é»ç‚ºåƒè€ƒé» */
      }
      .node {
    margin: 5px; /* èª¿æ•´ç¯€é»ä¹‹é–“çš„é–“è· */
}
      .hidden-node {
    visibility: hidden; /* éš±è—ç¯€é»å…§å®¹ï¼Œä½†ä¿ç•™ç©ºé–“ */
    background-color: transparent; /* ç¢ºä¿èƒŒæ™¯é€æ˜ */
    border: none; /* ç§»é™¤é‚Šæ¡† */
}
      .node[data-category="æŠ€è¡“"] {
    background-color: #f4d03f; /* æŠ€è¡“ - é»ƒè‰² */
}
      .node[data-category="ç”Ÿæ´»"] {
    background-color: #76d7c4; /* ç”Ÿæ´» - ç¶ è‰² */
}
      .node[data-category="äººç‰©"] {
    background-color: #a569bd; /* äººç‰© - ç´«è‰² */
}
      .node[data-category="æ™‚äº‹"] {
    background-color: #5dade2; /* æ™‚äº‹ - è—è‰² */
}

      .board {
    gap: 4px; /* å¢åŠ ç¯€é»é–“è· */
}
@media (max-width: 600px) {
    .board {
        width: 95vw; /* ä½¿ç”¨è¦–çª—å¯¬åº¦çš„ 95% */
        height: 95vw; /* ç¢ºä¿æ˜¯æ­£æ–¹å½¢ */
        gap: 2px; /* æ¸›å°‘ç¯€é»é–“çš„é–“è· */
    }
    .node {
        width: auto; /* è‡ªå‹•èª¿æ•´ç¯€é»å¤§å° */
        height: auto;
        font-size: 10px; /* ç¸®å°æ–‡å­—å¤§å° */
    }
  #choiceContainer {
    display: none; /* é è¨­éš±è— */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border: 2px solid #ccc;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
}
.wish-modal {
            /* åˆå§‹ç‹€æ…‹è¨­ç‚ºéš±è— */
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            /* å›ºå®šå¯¬åº¦å’Œé«˜åº¦ */
            width: 400px;
            height: 300px;
            /* é˜²æ­¢èª¿æ•´å¤§å° */
            resize: none;
            /* é˜²æ­¢æ‹–æ›³ */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .wish-modal h2 {
            color: #d4af37;
            text-align: center;
            margin-bottom: 20px;
            /* é˜²æ­¢æ–‡å­—è¢«é¸å– */
            user-select: none;
        }

        .wish-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            /* è¨­å®šå›ºå®šé«˜åº¦ */
            height: calc(100% - 60px);
        }

        .wish-input {
            /* è¨­å®šå›ºå®šå¤§å° */
            width: calc(100% - 20px);
            height: 150px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            /* å…è¨±æ–‡å­—å€åŸŸçš„å‚ç›´æ»¾å‹• */
            resize: none;
            overflow-y: auto;
        }

        .wish-submit {
            background-color: #d4af37;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            /* ä¿æŒåœ¨åº•éƒ¨ */
            margin-top: auto;
        }

        .wish-submit:hover {
            background-color: #c19b2c;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            /* é˜²æ­¢äº’å‹• */
            pointer-events: none;
        }

        /* ç•¶è¦–çª—è¼ƒå°æ™‚çš„éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 500px) {
            .wish-modal {
                width: 90%;
                height: 280px;
            }
            
            .wish-input {
                height: 120px;
            }
            @media screen and (max-width: 768px) {
    body {
        padding: 10px;
        font-size: 14px;
    }

    .board {
        width: 95vmin;
        height: 95vmin;
        gap: 1px;
    }

    .node {
        width: calc(95vmin / 11 - 2px);
        height: calc(95vmin / 11 - 2px);
        font-size: 10px;
        padding: 2px;
    }

    .controls {
        margin: 10px 0;
    }

    .button {
        padding: 8px 16px;
        font-size: 14px;
        margin: 5px;
        min-height: 44px; /* ç¢ºä¿è§¸æ§å€åŸŸè¶³å¤ å¤§ */
    }

    .dice {
        width: 40px;
        height: 40px;
    }

    .question-container {
        width: 90%;
        max-width: 400px;
        padding: 15px;
    }

    .question-container button {
        min-height: 44px;
        margin: 8px 0;
        font-size: 14px;
    }

    .wish-modal {
        width: 90%;
        max-width: 400px;
        height: auto;
        padding: 15px;
    }

    .wish-input {
        height: 100px;
    }
}
            .button-group {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
    }
    
    .scoreboard-btn {
        background-color: #28a745; /* ä½¿ç”¨ç¶ è‰²ä¾†å€åˆ†ä¸åŒåŠŸèƒ½çš„æŒ‰éˆ• */
    }
    
    .scoreboard-btn:hover {
        background-color: #218838;
    }
    
    @media screen and (max-width: 768px) {
        .button-group {
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .button {
            width: 200px; /* åœ¨æ‰‹æ©Ÿç‰ˆé¢ä¸Šè¨­å®šå›ºå®šå¯¬åº¦ */
            min-height: 44px; /* ç¢ºä¿è§¸æ§é¢ç©è¶³å¤  */
        }
    }
    </style>

</head>
<body>
    <h1>2025å°¾ç‰™éŠæˆ²(æ¸¬è©¦ç‰ˆ)</h1>
    <div class="controls">
    <p>ç©å®¶åç¨±ï¼š<input type="text" id="name" placeholder="è¼¸å…¥åå­—" /></p>
    <div class="button-group">
        <button class="button" id="startGame">é–‹å§‹éŠæˆ²</button>
        <button class="button scoreboard-btn" id="viewScoreboard" onclick="window.location.href='result.html'">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
    </div>
</div>
<div class="board" id="board" style="display: none;"></div>
<div class="controls" style="display: none;" id="gameControls">
        <p>ç•¶å‰åˆ†æ•¸ï¼š<span id="score">100</span></p>
        <p>æ“²éª°çµæœï¼š<span id="diceResult">-</span></p>
        <div class="dice" id="dice">
            <div class="dice-face" id="diceFace"></div>
        </div>
        <button class="button" id="rollDice">æ“²éª°</button>
    </div>
    <div class="scoreboard">
        <h2>è¨ˆåˆ†ç‰ˆ</h2>
        <table>
            <thead>
                <tr>
                    <th>ç©å®¶åç¨±</th>
                    <th>æœ€çµ‚åˆ†æ•¸</th>
                </tr>
            </thead>
            <tbody id="scoreboard"></tbody>
        </table>
    </div>
    <div class="history">
        <h2>éŠç©ç´€éŒ„</h2>
        <table>
            <thead>
                <tr>
                    <th>ç©å®¶åç¨±</th>
                    <th>æœ€çµ‚åˆ†æ•¸</th>
                    <th>éŠç©æ™‚é–“</th>
                </tr>
            </thead>
            <tbody id="history"></tbody>
        </table>
    </div>
    <div class="question-container" id="questionContainer">
        <h2 id="questionText">å•é¡Œ</h2>
        <div id="options"></div>
    </div>
  <div class="question-container" id="choiceContainer">
    <h2>æ˜¯å¦ç­”é¡Œï¼Ÿ</h2>
    <button id="answerButton" class="button">ç­”é¡Œ</button>
    <button id="passButton" class="button">è·³é (-10åˆ†)</button>
</div>
<div class="modal-overlay" id="wishOverlay"></div>
    <div class="wish-modal" id="wishModal">
        <h2>ğŸŒŸ æ–°å¹´ç¥ç¦ 2025 ğŸŒŸ</h2>
        <form class="wish-form" id="wishForm">
            <textarea 
                class="wish-input" 
                placeholder="åœ¨é€™è£¡å¯«ä¸‹ä½ çš„æ–°å¹´æœŸè¨±æˆ–ç¥ç¦..."
                maxlength="200"
                required
            ></textarea>
            <button type="submit" class="wish-submit">é€å‡ºç¥ç¦</button>
        </form>
    </div>
    <script>
        // Google Apps Script ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€
const googleAppsScriptUrl = 'https://script.google.com/macros/s/AKfycbyem6VpFwrNopc5B_xWO8I6B7SsNvX41KJBzMcZMD_s-f8rxdiFOSO-p4olnvsGaM8/exec'; // æ›¿æ›ç‚ºæ‚¨çš„ç¶²å€

// ä¿®æ”¹ sendGameResult å‡½æ•¸ä»¥ç¢ºä¿æ­£ç¢ºè™•ç† wish åƒæ•¸
async function sendGameResult(playerName, score, wishText) {
    // å‰µå»ºåŠ è¼‰æç¤º
    const loadingMessage = createLoadingMessage();
    document.body.appendChild(loadingMessage);

    try {
        // æº–å‚™æ•¸æ“š
        const data = {
            playerName: playerName,
            score: score,
            wish: wishText || '',
            timestamp: new Date().toISOString()
        };

        // ä½¿ç”¨ URL æœç´¢åƒæ•¸
        const params = new URLSearchParams(data);
        const url = `${googleAppsScriptUrl}?${params.toString()}`;

        // è¨­ç½®è«‹æ±‚é¸é …
        const requestOptions = {
            method: 'GET',
            mode: 'cors',
            headers: {
                'Accept': 'application/json'
            },
            redirect: 'follow',
            referrerPolicy: 'no-referrer'
        };

        // æ·»åŠ è¶…æ™‚è™•ç†
        const timeout = 30000;
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), timeout);
        requestOptions.signal = controller.signal;

        // ç™¼é€è«‹æ±‚
        const response = await fetch(url, requestOptions);
        clearTimeout(timeoutId);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        if (result.status === 'success') {
            // é¡¯ç¤ºæˆåŠŸæ¶ˆæ¯
            loadingMessage.textContent = 'å„²å­˜æˆåŠŸï¼æ­£åœ¨å‰å¾€æ’è¡Œæ¦œ...';
            loadingMessage.style.background = 'rgba(0, 128, 0, 0.8)';
            
            // å»¶é²è·³è½‰
            await new Promise(resolve => setTimeout(resolve, 2000));
            window.location.href = 'result.html';
        } else {
            throw new Error(result.message || 'ä¼ºæœå™¨å›æ‡‰ç•°å¸¸');
        }

    } catch (error) {
        console.error('Error:', error);
        handleError(error.message, loadingMessage);
    }
}

// å‰µå»ºåŠ è¼‰æç¤ºå…ƒç´ 
function createLoadingMessage() {
    const loadingMessage = document.createElement('div');
    loadingMessage.style.position = 'fixed';
    loadingMessage.style.top = '50%';
    loadingMessage.style.left = '50%';
    loadingMessage.style.transform = 'translate(-50%, -50%)';
    loadingMessage.style.background = 'rgba(0, 0, 0, 0.8)';
    loadingMessage.style.color = 'white';
    loadingMessage.style.padding = '20px';
    loadingMessage.style.borderRadius = '10px';
    loadingMessage.style.zIndex = '9999';
    loadingMessage.textContent = 'æ­£åœ¨å„²å­˜è³‡æ–™...';
    return loadingMessage;
}

// éŒ¯èª¤è™•ç†
function handleError(message, loadingMessage) {
    loadingMessage.textContent = `${message}\né»æ“Šæ­¤è™•é‡è©¦`;
    loadingMessage.style.background = 'rgba(255, 0, 0, 0.8)';
    loadingMessage.style.cursor = 'pointer';
    
    // æ·»åŠ é‡è©¦äº‹ä»¶ç›£è½å™¨
    const retryHandler = async () => {
        loadingMessage.removeEventListener('click', retryHandler);
        document.body.removeChild(loadingMessage);
        await sendGameResult(playerName, score, wishText);
    };
    
    loadingMessage.addEventListener('click', retryHandler);
}

        const board = document.getElementById('board');
        const gameControls = document.getElementById('gameControls');
        const scoreDisplay = document.getElementById('score');
        const diceResultDisplay = document.getElementById('diceResult');
        const rollDiceButton = document.getElementById('rollDice');
        const nameInput = document.getElementById('name');
        const Button = document.getElementById('');
        const scoreboardTable = document.getElementById('scoreboard');
        const historyTable = document.getElementById('history');
        const questionContainer = document.getElementById('questionContainer');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('options');
        const diceFace = document.getElementById('diceFace');
      const choiceContainer = document.getElementById('choiceContainer');
const answerButton = document.getElementById('answerButton');
const passButton = document.getElementById('passButton');

const GameState = {
    saveState: function(state) {
        const gameState = {
            playerName: state.playerName,
            score: state.score,
            playerPosition: state.playerPosition,
            totalNodesTravelled: state.totalNodesTravelled,
            completedLaps: state.completedLaps,
            isGameOver: state.isGameOver,
            gameStartTime: state.gameStartTime || Date.now(),
            lastUpdateTime: Date.now()
        };
        
        localStorage.setItem('currentGameState', JSON.stringify(gameState));
        localStorage.setItem('gameInProgress', 'true');
    },

    loadState: function() {
        const savedState = localStorage.getItem('currentGameState');
        const gameInProgress = localStorage.getItem('gameInProgress');
        
        if (savedState && gameInProgress === 'true') {
            return JSON.parse(savedState);
        }
        return null;
    },

    clearState: function() {
        localStorage.removeItem('currentGameState');
        localStorage.removeItem('gameInProgress');
    },

    hasActiveGame: function() {
        return localStorage.getItem('gameInProgress') === 'true';
    },

    isStateValid: function(state) {
        if (!state || !state.lastUpdateTime) return false;
        const MAX_GAME_DURATION = 30 * 60 * 1000; // 30åˆ†é˜
        return (Date.now() - state.lastUpdateTime) < MAX_GAME_DURATION;
    }
};
        
// ç©å®¶é¸æ“‡ç­”é¡Œ
answerButton.addEventListener('click', () => {
    choiceContainer.style.display = "none"; // éš±è—é¸æ“‡è¦–çª—
    askQuestion(playerPosition); // å‘¼å«é¡Œç›®é¡¯ç¤ºå‡½æ•¸
});

// ç©å®¶é¸æ“‡è·³é
passButton.addEventListener('click', () => {
    choiceContainer.style.display = "none"; // éš±è—é¸æ“‡è¦–çª—
    score -= 10; // æ‰£é™¤10åˆ†
    scoreDisplay.textContent = score; // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
    rollDiceButton.disabled = false; // å•Ÿç”¨éª°å­æŒ‰éˆ•
});

        let playerName = ""; // æ–°å¢å…¨åŸŸè®Šé‡        
        let score = 100;
        let playerPosition = 0;
        let totalNodesTravelled = 0;
        const totalNodes = 40;
        let completedLaps = 0; // æ–°å¢è®Šæ•¸ï¼Œè¿½è¹¤å®Œæˆçš„è¿´åœˆæ•¸
        let isGameOver = false; // æ–°å¢è®Šæ•¸ï¼ŒéŠæˆ²æ˜¯å¦çµæŸ
        const questions = {
        æŠ€è¡“: [
        { text: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯è¬å¹´æ¸…æ–°äººæ•™è‚²è¨“ç·´çš„æ¨¡çµ„åç¨±ï¼Ÿ", options: ["åœŸæœ¨åŸºç¤", "ç’°å·¥åŸºç¤", "ç›£é€ åŸºç¤"], answer: "åœŸæœ¨åŸºç¤" },
        { text: "ECå¸¸ç”¨çš„æ³µæµ¦å…¥å£è¨­è¨ˆæµé€Ÿç‚ºå¤šå°‘m/sï¼Ÿ", options: ["0.5", "1", "1.5"], answer: "1" },
        { text: "ä¸‹åˆ—ä½•è€…ç‚ºåŒ–å­¸éœ€æ°§é‡è‹±æ–‡ç°¡ç¨±ï¼Ÿ", options: ["COD", "CQD", "CGD"], answer: "COD" },
        { text: "çµç®—è‡³ç­”é¡Œç•¶ä¸‹ï¼Œè¬å¹´æ¸…ç¸½å…±æ“æœ‰å¹¾å€‹å•†æ¨™?", options: ["8", "9", "10"], answer: "10" },
        { text: "ä¸‹åˆ—å“ªä¸€å€‹å·¥ç¨‹æ¡ˆå€æ‰€åœ¨ä¹‹åœ°ç†ä½ç½®æœ€å—?", options: ["è¶Šå—æ³°æˆ", "ç¦å»ºæ³°æ…¶", "ç‡èˆˆå²¡å±± "], answer: "è¶Šå—æ³°æˆ" },
        { text: "2024å¹´è¬å¹´æ¸…ç‡Ÿæ”¶ç´„ç‚º____ï¼Œè¿ä¾†æ­·å²æ–°é«˜ï¼", options: ["6å„„8", "6å„„6", "6å„„4"], answer: "6å„„4" },
        { text: "ä¸‹åˆ—ä½•è€…ç‚º2024å¹´è¬å¹´æ¸…è²¡å ±ç°½è­‰äº‹å‹™æ‰€?", options: ["å‹¤æ¥­çœ¾ä¿¡è¯åˆæœƒè¨ˆå¸«äº‹å‹™æ‰€", "è³‡èª è¯åˆæœƒè¨ˆå¸«äº‹å‹™æ‰€", "å®‰æ°¸è¯åˆæœƒè¨ˆå¸«äº‹å‹™æ‰€"], answer: "å®‰æ°¸è¯åˆæœƒè¨ˆå¸«äº‹å‹™æ‰€" },
        { text: "ä¸‹åˆ—ä½•è€…ç‚ºè¬å¹´æ¸…è¶Šå—å­å…¬å¸æ‰€è™•ç¸£å¸‚?", options: ["èƒ¡å¿—æ˜å¸‚", "æ²³å…§å¸‚", "æµ·é˜²å¸‚"], answer: "èƒ¡å¿—æ˜å¸‚" },
        { text: "ä¸‹åˆ—ä½•è€…ç‚ºè¬å¹´æ¸…å°åº¦å…¬å­å¸æ‰€è™•ä¹‹è¡Œæ”¿å€?", options: ["æ¸…å¥ˆ", "æ–°å¾·é‡Œ", "å­Ÿè²·"], answer: "æ¸…å¥ˆ" },
        { text: "çµç®—è‡³ç­”é¡Œç•¶ä¸‹ï¼Œ2024å¹´è¬å¹´æ¸…æ–°å¢ä¾›æ‡‰å•†æ•¸é‡æœ€æ¥è¿‘ä¸‹åˆ—å“ªå€‹æ•¸å­—?", options: ["73", "83", "93"], answer: "93" },
        { text: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯2024å¹´å…¬å¸åŒä»é‡å°çŸ¯æ­£é é˜²æªæ–½å–®æå‡ºçš„æ°¸ä¹…é é˜²å°ç­–ï¼Ÿ", options: ["æ¬„æ†é¡è¨­å‚™å» é©—æ™‚ï¼Œéœ€ç¢ºèªé«˜åº¦æ˜¯å¦ç¬¦åˆã€‚", "è„«æ°´æ©Ÿæ¿¾æ¶²æ­£å¸¸æ‡‰å›è‡³å‰ç«¯å†è¡Œè™•ç†ï¼Œå¦‚é‡åŠ›æµç„¡æ³•é †åˆ©æµå›ï¼Œå‰‡éœ€å¢åŠ è¼¸é€æ³µã€‚", "ä½¿ç”¨å„€å„€å™¨æ¸¬é‡æ™‚ï¼Œéœ€æ³¨æ„å„€å™¨ä½¿ç”¨çš„æ³¨æ„äº‹é …ã€‚"], answer: "ä½¿ç”¨å„€å„€å™¨æ¸¬é‡æ™‚ï¼Œéœ€æ³¨æ„å„€å™¨ä½¿ç”¨çš„æ³¨æ„äº‹é …ã€‚" },
        { text: "ä¾æœ¬å¹´åº¦è¬å¹´æ¸…å…§éƒ¨å®£å°æªæ–½ï¼Œå› äººç‚ºç–å¤±å°è‡´å…¬å‹™è»Šæ²’é›»ï¼Œéœ€ç½°åšå¹¾æ¬¡å€¼æ—¥ç”Ÿï¼Ÿ", options: ["3", "4", "5"], answer: "5" },
        { text: "ä»¥2024å¹´ç‚ºé™ï¼Œè¬å¹´æ¸…ç¸½å…±æ‰¿æ”¬äº†å¹¾å€‹Pæ¡ˆ?", options: ["14", "12", "10"], answer: "12" },
        ],
        ç”Ÿæ´»: [
        { text: "2025çš„æ–°å¹´ä½ˆç½®ä¸­ï¼Œ5F(ç®¡ç†éƒ¨)é›»å‹•é–€æ—çš„é‹æ«ƒä¸Šç¸½å…±æ“ºäº†å¹¾é¡†ç«‹é«”é‡‘å…ƒå¯¶ï¼Ÿ", options: ["0", "5", "10"], answer: "5" },
        { text: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯å…¬å¸(EC)é™„è¿‘çš„å¹³æ°‘å°åƒï¼Ÿ", options: ["çˆ†æ±ç†Šé›æ’", "å“æº±ç¾é£ŸåŠ", "å¤©æ¶¯æµ·é¤ƒ"], answer: "å¤©æ¶¯æµ·é¤ƒ" },
        { text: "è¬å¹´æ¸…4F(ç ”å‰µéƒ¨)çš„ç‰†ä¸Šï¼Œç¸½å…±æ›äº†å¹¾å¼µçç‹€/å°ˆåˆ©/è­‰æ›¸ï¼Ÿ", options: ["20", "30", "40"], answer: "30" },
        { text: "EC 3Fæœƒè­°å®¤çš„ã€Œæœƒè­°ä¸­ã€æ›ç‰Œåœ–æ¡ˆä¸Šï¼Œå››è‘—äººåœååœ¨å“ªè£¡é–‹æœƒï¼Ÿ", options: ["å…¬åœ’", "å±±å³°", "æ¸¸æ³³æ± "], answer: "å±±å³°" },
        { text: "ä¸‹åˆ—å…¬å¸å‘¨é‚Šçš„åº—å®¶/è¨­æ–½ï¼Œä½•è€…ä¸åœ¨é¾å¯Œè·¯äº”æ®µï¼Ÿ", options: ["å¤§éƒ½æœƒæ¢ç´¢å¹¼å…’åœ’", "å·¦è¥¿äººæ–‡ç©ºé–“", "é¾å‰182äº”é‡‘"], answer: "é¾å‰182äº”é‡‘" },
        { text: "çµç®—è‡³ç­”é¡Œç•¶ä¸‹ï¼Œå“ªä¸€å°ECå…¬å‹™è»Šçš„é‡Œç¨‹æ•¸å·²ç¶“è¶…é50è¬?", options: ["2726-PW", "2727-PQ", "0253-D2"], answer: "2726-PW" },
        { text: "2024å¹´9ã€10æœˆï¼ŒECæ…¶ç”Ÿæœƒç‚ºå£½æ˜Ÿæº–å‚™çš„æ˜¯å“ªä¸€å®¶çš„è›‹ç³•?", options: ["ç´…è‘‰è›‹ç³•", "éº¥ä»•ä½³", "Hafu"], answer: "Hafu" },
        { text: "ä»¥2024å¹´çµç®—ï¼Œä¸‹åˆ—å“ªä¸€é–“é¤å»³ç‚ºè¬å¹´æ¸…èšé¤æ¬¡æ•¸çš„TOP1?", options: ["è“å¤§ç›¤", "é˜¿ç§‹å¤§è‚¥éµ", "å£½å¸éƒ"], answer: "é˜¿ç§‹å¤§è‚¥éµ" },
        { text: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯è¬å¹´æ¸…è¾¦å…¬å®¤åç‰Œçš„é…è‰²ï¼Ÿ", options: ["ç¶ åº•ç™½å­—", "ç™½åº•é»‘å­—", "ç°åº•ç™½å­—"], answer: "ç™½åº•é»‘å­—" },
        { text: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯è¬å¹´æ¸…2024è–èª•æ´»å‹•å‡ºç¾çš„ç¦®ç‰©ï¼Ÿ", options: ["æœ‰å‰¯ä¸»å§”è…³å°çš„å¡ç‰‡", "ä¹¾ç²‰æ»…ç«å™¨", "ä¸é½é‹¼é´›é´¦é‹"], answer: "ä¸é½é‹¼é´›é´¦é‹" },
        ],
        äººç‰©: [
        { text: "çµç®—è‡³ç­”é¡Œç•¶ä¸‹ï¼Œä½•å‰¯ç¸½çš„ä¸‰æ¨“è¾¦å…¬å®¤å…§å…±æœ‰å¹¾æ ªæ¤æ ½ï¼Ÿ", options: ["5", "6", "7"], answer: "5" },
        { text: "ä¸‹åˆ—ç¦å§”æˆå“¡çš„åå­—ï¼Œå…±æœ‰å¹¾å€‹éŒ¯å­—ï¼Ÿ[é»ƒæ™§ç‘œ/æ—äºå´´/é‚±é›ç¿/å“å®—ç…’]", options: ["5", "4", "3"], answer: "4" },
        { text: "2024è¬å¹´æ¸…èˆ‰è¾¦çš„è–èª•æ´»å‹•ä¸­ï¼Œèª°æ²’æœ‰æŠ½åˆ°å¼µç¸½çš„åŠ ç¢¼ç¦®ç‰©", options: ["é™³å‡±é›¯", "å‘¨æ€¡æ±", "å®‹å®‡æ™¨"], answer: "å®‹å®‡æ™¨" },
        { text: "æ—å¥•ç”«èª²é•·çš„Lineå€‹äººä¸»é¡Œè²¼åœ–ã€Œç¥å¥‡aæ—yifuã€ä¸­ï¼Œä¸åŒ…å«ä¸‹åˆ—å“ªå€‹è¡¨æƒ…ï¼Ÿ", options: ["ç”Ÿæ—¥å¿«æ¨‚", "åˆ¥å°çœ‹æˆ‘", "æˆ‘é‚„å¾ˆé¤“"], answer: "æˆ‘é‚„å¾ˆé¤“" },
        { text: "çµç®—è‡³ç­”é¡Œç•¶ä¸‹ï¼Œ216æ˜¯å“ªä½ECåŒä»çš„åˆ†æ©Ÿè™Ÿç¢¼?", options: ["é¾å“¥", "ç´˜ç‘œ", "æŸå»·"], answer: "é¾å“¥" },
        { text: "2024/4/18ï¼Œç¥ºæ›œé§•é§›å“ªä¸€è¼›å…¬å‹™è»Šå‡ºå·®è¢«é–‹äº†ä¸€å¼µè¶…é€Ÿç½°å–®ï¼Ÿ", options: ["BRP-3006", "0017-WG", "ABZ-3808"], answer: "BRP-3006" },
        { text: "ä¾ç…§2024/11/18è¬å¹´æ¸…é ’å¸ƒä¹‹æœ€æ–°æ¶ˆé˜²ç·¨åˆ¶ï¼Œå®‰å…¨é˜²å‹™ç­ç­é•·æ˜¯ç”±å“ªä½åŒä»æ“”ä»»ï¼Ÿ", options: ["è”¡å®œè»’", "æ¹¯å­è±", "æ—å­è»’"], answer: "è”¡å®œè»’" },
        { text: "ä¸‹åˆ—å“ªä¸€ä½å…¬å¸åŒä»å¤§å­¸ä¸æ˜¯ç•¢æ¥­æ–¼ä¸­èˆˆç’°å·¥ç³»ï¼Ÿ", options: ["æ›¾ç«‹å¾·", "é‚µä½œåš", "å¼µæ¹˜æ£‹"], answer: "æ›¾ç«‹å¾·" },
        { text: "ä¸‹åˆ—å“ªä¸€ä½å…¬å¸åŒä»ä¸¦æœªæ–¼2024å¹´é–“è‡³å·¥æ¡ˆç¾å ´åŸ·è¡Œè©¦è»Šå·¥ä½œï¼Ÿ", options: ["ç›§å† ç¾½", "æ¥Šå®œåº­", "æ—å­èƒ"], answer: "æ¥Šå®œåº­" },
        { text: "åƒç…§113å¹´åº¦å…¬å¸å…§éƒ¨æä¾›çš„å®£å°ç°¡å ±ï¼Œè‹¥æœ‰èª ä¿¡ç¶“ç‡Ÿç›¸é—œç–‘å•ï¼Œæ‡‰æ´½è©¢å“ªä½ä¸»ç®¡ï¼Ÿ", options: ["é‚±ç‡•ç¿_å…¬å¸æ²»ç†ä¸»ç®¡", "æç æ¨º_ç¨½æ ¸ä¸»ç®¡", "é™³å»ºä»»_å”ç†"], answer: "é‚±ç‡•ç¿_å…¬å¸æ²»ç†ä¸»ç®¡" },
        { text: "ä¸‹åˆ—å“ªä½è¬å¹´æ¸…æ¥­å‹™éƒ¨åŒä»çš„åˆ†æ©Ÿæ•¸å­—ç¸½å’Œç‚º10ï¼Ÿ", options: ["æ—ä¸–å¼·", "æ—æ›¸å»·", "æ—æ¬£éš"], answer: "æ—ä¸–å¼·" },
        { text: "2024å¹´12æœˆï¼Œæ¥­å‹™éƒ¨ä¸»ç®¡æä¿Šç©å”ç†æ²’æœ‰å®‰æ’è‡³ä¸‹åˆ—å“ªå€‹åœ°é»å‡ºå·®ï¼Ÿï¼Ÿ", options: ["è±†ä¹‹å®¶", "å‘³å…¨", "åœ‹åŸé™¢"], answer: "å‘³å…¨" },
        ],
        æ™‚äº‹: [
        { text: "2024/5æœˆï¼Œè‹±ç‹æŸ¥çˆ¾æ–¯ä¸‰ä¸–æ–¼ç™½é‡‘æ¼¢å®®æ­å¹•ç™»åŸºå¾Œçš„é¦–å¼µå®˜æ–¹å€‹äººè‚–åƒç•«ã€‚è«‹å•è©²ç•«ä½œå¤§é‡ä½¿ç”¨ä½•ç¨®é¡è‰²åšç‚ºèƒŒæ™¯ï¼Ÿ", options: ["ç™½è‰²", "ç´…è‰²", "è—è‰²"], answer: "ç´…è‰²" },
        { text: "é­·é­šéŠæˆ²2æ˜¯Netflixæ–¼2024å¹´12æœˆ26æ—¥ä¸Šç·šçš„åŸå‰µéŸ“åœ‹åŠ‡é›†ï¼Œä¸‹åˆ—å“ªä¸€ä½å‰Bigbangæˆå“¡æœ‰åƒèˆ‡è©²åŠ‡çš„æ¼”å‡º?", options: ["TOP", "å‹åˆ©", "å¤ªé™½"], answer: "TOP" },
        { text: "ç¾ä»»è¼é”åŸ·è¡Œé•·é»ƒä»å‹³æ–¼2025å¹´1æœˆæŠµé”å°ç£é€¢ç”²å¤œå¸‚ï¼Œè«‹å•é€™æ¬¡ä»–å“å˜—äº†å“ªä¸€æ¨£åœ¨åœ°å°åƒï¼Ÿ", options: ["é›æ’", "è›‹æ²™æ‹‰", "å•¥éƒ½æ²’åƒ"], answer: "å•¥éƒ½æ²’åƒ" },
        { text: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯2024å°ç£æ£’å£‡ç´…äººé™³å‚‘æ†²çš„å¤ªå¤ª-ç¶ºç¶º-æ›¾åŠ å…¥éçš„åœ˜é«”?", options: ["Passion Sisters", "Rhinos Angels", "Uni Girls"], answer: "Uni Girls" },
        { text: "2024æ£’å£‡é‡‘å¥ã€Œå…„å¼Ÿé½Šå¿ƒ,å¤§å®¶éƒ½æ„›çŸ­ä»Šã€åŸæ–‡å‡ºè‡ªæ–¼ä¸‹åˆ—å“ªä½é‹å‹•å“¡ä¹‹å£ï¼Ÿ", options: ["å‘¨æ€é½Š", "æ±Ÿå¤å®‡", "æ—æ˜æ°"], answer: "æ—æ˜æ°" },
        { text: "ä¸‹åˆ—å“ªä½è—äººæ²’æœ‰ä»¥å˜‰è³“èº«ä»½å‡ºå¸­2024/12æœˆä»½å‘¨æ°å€«å˜‰å¹´è¯ä¸–ç•Œå·¡è¿´æ¼”å”±å°åŒ—å ´æ¬¡ï¼Ÿ", options: ["æ±Ÿè•™", "æ—ä¿Šå‚‘", "å¼µæƒ å¦¹"], answer: "æ—ä¿Šå‚‘" },
        { text: "è¥¿æ›†2024å¹´é–“ï¼Œä¸‹åˆ—å“ªä½è—äºº/åœ˜é«”æ²’æœ‰åœ¨å°ç£èˆ‰è¾¦æ¼”å”±æœƒ/è¦‹é¢æœƒï¼Ÿ", options: ["5566", "Charlie Puth", "å¼µæƒ å¦¹"], answer: "5566" },
        { text: "ä¸‹åˆ—å“ªéƒ¨é›»å½±æ²’æœ‰åœ¨2024å¹´çš„å°ç£ä¸Šæ˜ ï¼Ÿ", options: ["å“¥å‰æ‹‰èˆ‡é‡‘å‰›ï¼šæ–°å¸åœ‹", "èª°å·äº†åƒåœ¾æ¡¶ï¼Ÿ", "è…¦ç­‹æ€¥è½‰å½2"], answer: "èª°å·äº†åƒåœ¾æ¡¶ï¼Ÿ" },
        { text: "ä¸‹åˆ—åœ‹éš›äº‹ä»¶ä½•è€…ä¸¦éç™¼ç”Ÿæ–¼2024ï¼Ÿ", options: ["æ—¥æœ¬çš‡å®¤é–‹è¨­Instagramå¸³è™Ÿ", "å·´é»è–æ¯é™¢é‡å»ºå®Œå·¥ï¼Œæ­£å¼å°å¤–é–‹æ”¾", "å¤§è°·ç¿”å¹³å®£å¸ƒåŒæ„ä»¥10å¹´7å„„ç¾é‡‘åˆç´„åŠ ç›Ÿé“å¥‡"], answer: "å¤§è°·ç¿”å¹³å®£å¸ƒåŒæ„ä»¥10å¹´7å„„ç¾é‡‘åˆç´„åŠ ç›Ÿé“å¥‡" },
        { text: "æˆªè‡³2025/02/26å‰ï¼Œæ–¼è‚¯å¾·åŸºæ¶ˆè²»çµå¸³æ™‚è¼¸å…¥ä¸‹åˆ—å“ªä¸€çµ„å„ªæƒ ç¢¼ï¼Œå³å¯ç²å¾—è³¼è²·ï¼“é¡†åŸå‘³è›‹å¡”å…è²»è´ˆï¼‘é¡†å„ªæƒ ï¼Ÿ", options: ["14406", "14407", "14408"], answer: "14408" },
        { text: "2024å·´é»å¥§é‹æœƒä¸Šï¼Œä¸­è¯å°åŒ—åœ˜ä¸¦æœªç²å¾—å“ªå€‹è³½äº‹çš„çç‰Œï¼Ÿ", options: ["é«”æ“", "ç¾½çƒ", "é«˜çˆ¾å¤«"], answer: "é«˜çˆ¾å¤«" },
        ],
    };
        const loadHistory = () => {
            try {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];
                historyTable.innerHTML = "";
                history.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${record.name}</td><td>${record.score}</td><td>${record.time}</td>`;
                    historyTable.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading history: ", error);
            }
        };

        const saveToHistory = (playerName, score) => {
            try {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];
                const time = new Date().toLocaleString();
                history.push({ name: playerName, score, time });
                localStorage.setItem('gameHistory', JSON.stringify(history));
            } catch (error) {
                console.error("Error saving to history: ", error);
            }
        };

      function adjustBoardSize() {
    const board = document.querySelector('.board');
    const nodes = document.querySelectorAll('.node');
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    const smallerDimension = Math.min(viewportWidth, viewportHeight);

    // èª¿æ•´åœ°åœ–å®¹å™¨å¤§å°
    const boardSize = smallerDimension * 0.9; // åœ°åœ–å®¹å™¨å è¢å¹•çš„ 90%
    board.style.width = `${boardSize}px`;
    board.style.height = `${boardSize}px`;

    // è¨ˆç®—æ¯å€‹ç¯€é»çš„å¤§å°
    const gridSize = Math.sqrt(nodes.length); // å‡è¨­ç¯€é»æ˜¯æ­£æ–¹å½¢æ’åˆ—
    const nodeSize = boardSize / gridSize; // ç¯€é»å¤§å° = å®¹å™¨å¤§å° / æ ¼æ•¸
    nodes.forEach(node => {
        node.style.width = `${nodeSize}px`;
        node.style.height = `${nodeSize}px`;
        node.style.fontSize = `${nodeSize / 5}px`; // èª¿æ•´æ–‡å­—å¤§å°
    });
}

// ç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚åŸ·è¡Œ
window.addEventListener('resize', adjustBoardSize);

// é é¢åŠ è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡
adjustBoardSize();

const specialCorners = []; // å„²å­˜ç‰¹æ®Šè§’è½çš„ç´¢å¼•

const createNodes = () => {
    for (let i = 0; i < 11; i++) {
        for (let j = 0; j < 11; j++) {
            const node = document.createElement('div');
            const isEdge = (i === 0 || i === 10 || j === 0 || j === 10);
            const isCorner = (i === 0 && j === 0) || (i === 0 && j === 10) || 
                           (i === 10 && j === 0) || (i === 10 && j === 10);

            if (isCorner) {
                node.classList.add('node', 'corner');
                
                // å·¦ä¸Šè§’è¨­ç‚ºèµ·å§‹é»
                if (i === 0 && j === 0) {
                    node.textContent = 'START';
                    node.dataset.name = 'start';
                } else {
                    node.textContent = 'ç‰¹æ®Šè§’è½';
                    node.dataset.name = 'ç‰¹æ®Šè§’è½';
                }
                
                const cornerIndex = calculateNodeIndex(i, j);
                node.dataset.index = cornerIndex;
                specialCorners.push(cornerIndex);
            } else if (isEdge) {
                node.classList.add('node', 'path');
                const nodeIndex = calculateNodeIndex(i, j);
                const categoryNames = ['æŠ€è¡“', 'ç”Ÿæ´»', 'äººç‰©', 'æ™‚äº‹'];
                const category = categoryNames[nodeIndex % 4];
                node.dataset.category = category;
                node.dataset.name = category;
                node.textContent = category;
                node.dataset.index = nodeIndex;
            } else {
                node.classList.add('node', 'hidden-node');
            }
            
            board.appendChild(node);
        }
    }
};

function adjustNodeStyles() {
    const isSmallScreen = window.innerWidth < 600;
    const nodes = document.querySelectorAll('.node');
    nodes.forEach(node => {
        if (isSmallScreen) {
            node.style.fontSize = "10px"; /* ç¸®å°æ–‡å­— */
            node.style.padding = "2px";  /* æ¸›å°‘ç¯€é»é‚Šè· */
        } else {
            node.style.fontSize = "14px"; /* æ¢å¾©é è¨­å¤§å° */
            node.style.padding = "5px";
        }
    });
}

// ç•¶ä½¿ç”¨è€…æ”¹è®Šè£ç½®å°ºå¯¸æ™‚è§¸ç™¼
window.addEventListener('resize', adjustNodeStyles);

// é é¢åŠ è¼‰æ™‚ç«‹å³æª¢æŸ¥ä¸€æ¬¡
adjustNodeStyles();

        function calculateNodeIndex(row, col) {
            if (row === 0) return col;
            if (col === 10) return 10 + row;
            if (row === 10) return 30 - col;
            if (col === 0) return 30 + (10 - row);
            return null;
        }

        function updatePlayerPosition() {
    const nodes = document.querySelectorAll('.node');
    
    // é‡ç½®æ‰€æœ‰ç¯€é»çš„å…§å®¹
    nodes.forEach(node => {
        const category = node.dataset.category || node.dataset.name || '';
        node.innerHTML = ''; // ç¢ºä¿å…§å®¹è¢«æ¸…ç©º
        
        // æ’å…¥é¡åˆ¥åç¨±
        const categorySpan = document.createElement('span');
        categorySpan.textContent = category;
        node.appendChild(categorySpan);
    });

    // æ‰¾åˆ°ç©å®¶æ‰€åœ¨çš„ç¯€é»
    const currentNode = [...nodes].find(node => node.dataset.index == playerPosition);
    if (currentNode) {
        const playerElement = document.createElement('div');
        playerElement.classList.add('player');
        playerElement.textContent = "P";
        currentNode.appendChild(playerElement);
    }
}

      function checkSpecialCorner(position) {
    const nodes = document.querySelectorAll('.node');
    const currentNode = [...nodes].find(node => node.dataset.index == position);

    if (currentNode && currentNode.classList.contains('corner')) {
        handleSpecialCorner(currentNode.dataset.name);
    }
}

function handleSpecialCorner(cornerName) {
    if (cornerName === 'start') {
    rollDiceButton.disabled = false;
    return;
}
    switch (cornerName) {
        case 'ç‰¹æ®Šè§’è½':
            alert("æ­¡è¿ä¾†åˆ°ç‰¹æ®Šè§’è½ï¼ä½ ç²å¾—äº† 50 åˆ†çå‹µï¼");
            score += 50;
            break;
        default:
            alert(`ä½ é€²å…¥äº† ${cornerName}ï¼Œä½†ç›®å‰æ²’æœ‰å®šç¾©çš„è¡Œå‹•ã€‚`);
            break;
    }

    // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
    scoreDisplay.textContent = score;

    // éš±è—ã€Œæ˜¯å¦ç­”é¡Œã€å’Œå…¶ä»–ç›¸é—œè¦–çª—
    choiceContainer.style.display = "none";
    questionContainer.style.display = "none";

    // å•Ÿç”¨éª°å­æŒ‰éˆ•ï¼Œå…è¨±ç©å®¶ç¹¼çºŒéŠæˆ²
    rollDiceButton.disabled = false;
}
           
        function updateDiceFace(value) {
            const dots = [
                [],
                [4],
                [0, 8],
                [0, 4, 8],
                [0, 2, 6, 8],
                [0, 2, 4, 6, 8],
                [0, 2, 3, 5, 6, 8]
            ];
            diceFace.innerHTML = "";
            for (let i = 0; i < 9; i++) {
                const dot = document.createElement('div');
                dot.className = dots[value].includes(i) ? 'dot' : '';
                diceFace.appendChild(dot);
            }
        }

        rollDiceButton.addEventListener('click', () => {
    if (isGameOver) return;

    diceFace.classList.add('animate');
    rollDiceButton.disabled = true;

    const diceResult = 6;

    let rollingInterval = setInterval(() => {
        const randomValue = Math.floor(Math.random() * 6) + 1;
        updateDiceFace(randomValue);
    }, 100);

    setTimeout(() => {
        clearInterval(rollingInterval);
        diceFace.classList.remove('animate');
        updateDiceFace(diceResult);
        diceResultDisplay.textContent = diceResult;

        totalNodesTravelled += diceResult;

        const newLaps = Math.floor(totalNodesTravelled / totalNodes);

        if (newLaps >= 1) {
        alert("éŠæˆ²çµæŸï¼ä½ å®Œæˆäº† 3 å€‹å®Œæ•´è¿´åœˆï¼");
        console.log("éŠæˆ²çµæŸæ™‚çš„ playerName:", playerName);
        isGameOver = true;
        GameState.clearState(); // æ¸…é™¤éŠæˆ²ç‹€æ…‹
        handleGameEnd();
        rollDiceButton.disabled = true;
        rollDiceButton.textContent = "éŠæˆ²çµæŸ";
        return;
    }

        playerPosition = (playerPosition + diceResult) % totalNodes;
        updatePlayerPosition();

        setTimeout(() => {
            if (newLaps > completedLaps) {
                completedLaps = newLaps;
                alert(`æ­å–œï¼ä½ å®Œæˆäº†ç¬¬ ${completedLaps} å€‹è¿´åœˆï¼`);
            }

            // åˆ¤æ–·æ˜¯ç‰¹æ®Šè§’è½é‚„æ˜¯æ™®é€šç¯€é»
            if (specialCorners.includes(playerPosition)) {
                handleSpecialCorner('ç‰¹æ®Šè§’è½');
            } else {
                // é¡¯ç¤ºæ˜¯å¦ç­”é¡Œçš„é¸é …
                choiceContainer.style.display = "block";
                rollDiceButton.disabled = true; // ç¦ç”¨éª°å­æŒ‰éˆ•ï¼Œç­‰å¾…ç­”é¡Œæˆ–æ‰£åˆ†
            }
        }, 500);
    }, 1000);
});

// ä¿®æ”¹ handleGameEnd å‡½æ•¸
function handleGameEnd() {
    GameState.clearState(); // æ¸…é™¤éŠæˆ²ç‹€æ…‹
    const wishModal = document.getElementById('wishModal');
    const wishOverlay = document.getElementById('wishOverlay');
    const wishForm = document.getElementById('wishForm');
    
    wishModal.style.display = 'block';
    wishOverlay.style.display = 'block';
    
    wishForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const wishText = wishForm.querySelector('textarea').value.trim();
        sendGameResult(playerName, score, wishText);
        
        wishModal.style.display = 'none';
        wishOverlay.style.display = 'none';
    });
}
        // 3. æ–°å¢éŠæˆ²åˆå§‹åŒ–å‡½æ•¸
function initializeGame() {
    if (GameState.hasActiveGame()) {
        const savedState = GameState.loadState();
        if (savedState && GameState.isStateValid(savedState)) {
            const confirmResume = confirm('æª¢æ¸¬åˆ°æœªå®Œæˆçš„éŠæˆ²ï¼Œæ˜¯å¦è¦ç¹¼çºŒï¼Ÿ');
            if (confirmResume) {
                restoreGameState(savedState);
                return true;
            }
        }
        GameState.clearState();
    }
    return false;
}

// 4. æ–°å¢éŠæˆ²ç‹€æ…‹æ¢å¾©å‡½æ•¸
function restoreGameState(savedState) {
    playerName = savedState.playerName;
    score = savedState.score;
    playerPosition = savedState.playerPosition;
    totalNodesTravelled = savedState.totalNodesTravelled;
    completedLaps = savedState.completedLaps;
    isGameOver = savedState.isGameOver;
    
    nameInput.value = playerName;
    nameInput.disabled = true;
    document.getElementById('startGame').disabled = true;
    board.style.display = "grid";
    gameControls.style.display = "block";
    document.querySelector('.controls').style.display = "none";
    scoreDisplay.textContent = score;
    
    updatePlayerPosition();
}

// 5. æ–°å¢è‡ªå‹•ä¿å­˜è¨­ç½®å‡½æ•¸
function setupAutosave() {
    const AUTOSAVE_INTERVAL = 5000; // æ¯5ç§’è‡ªå‹•ä¿å­˜
    
    setInterval(() => {
        if (!isGameOver) {
            GameState.saveState({
                playerName,
                score,
                playerPosition,
                totalNodesTravelled,
                completedLaps,
                isGameOver
            });
        }
    }, AUTOSAVE_INTERVAL);
}

        function askQuestion(position) {
    if (isGameOver) return;

    const nodes = document.querySelectorAll('.node');
    const currentNode = [...nodes].find(node => node.dataset.index == position);

    if (!currentNode) {
        console.error("ç„¡æ³•æ‰¾åˆ°ç•¶å‰ç¯€é»ï¼Œä½ç½®ï¼š", position);
        return;
    }

    const category = currentNode.dataset.category;
    if (!category) {
        console.warn("ç•¶å‰ç¯€é»æ²’æœ‰åˆ†é¡ï¼Œè·³éç­”é¡Œã€‚");
        return;
    }

    const questionPool = questions[category];
    if (!questionPool || questionPool.length === 0) {
        console.warn("ç„¡å¯ç”¨é¡Œç›®ï¼Œåˆ†é¡ï¼š", category);
        return;
    }

    const questionIndex = Math.floor(Math.random() * questionPool.length);
    const question = questionPool[questionIndex];

    questionText.textContent = question.text;
    optionsContainer.innerHTML = "";

    question.options.forEach(option => {
        const button = document.createElement('button');
        button.textContent = option;
        button.addEventListener('click', () => {
            handleAnswer(option === question.answer);
        });
        optionsContainer.appendChild(button);
    });

    questionContainer.style.display = "block";
    rollDiceButton.disabled = true;
}
      function handleAnswer(isCorrect) {
    if (isCorrect) {
        alert("ç­”å°äº†ï¼åŠ 10åˆ†ï¼");
        score += 10;
    } else {
        alert("ç­”éŒ¯äº†ï¼æ‰£10åˆ†ï¼");
        score -= 10;
    }

    // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
    scoreDisplay.textContent = score;

    // éš±è—å•é¡Œå®¹å™¨
    questionContainer.style.display = "none";

    // å•Ÿç”¨æ“²éª°æŒ‰éˆ•
    if (!isGameOver) rollDiceButton.disabled = false;
}

// å°‡é€™æ®µç¨‹å¼ç¢¼åŠ åœ¨ JavaScript çš„æœ€å¾Œé¢
document.addEventListener('DOMContentLoaded', () => {
    if (!initializeGame()) {
        setupAutosave();
        
        const startGameButton = document.getElementById('startGame');
        const newButton = startGameButton.cloneNode(true);
        startGameButton.parentNode.replaceChild(newButton, startGameButton);
        
        newButton.addEventListener('click', () => {
            console.log("è¼¸å…¥æ¡†å€¼:", nameInput.value);
            playerName = nameInput.value.trim();
            console.log("å­˜å„²å¾Œçš„ playerName:", playerName);
            
            if (!playerName || playerName.length > 20 || !/^[\w\u4e00-\u9fa5]+$/.test(playerName)) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„åå­—ï¼ˆ20 å­—ä»¥å…§ï¼Œåƒ…åŒ…å«å­—æ¯ã€æ•¸å­—æˆ–ä¸­æ–‡ï¼‰ï¼");
                return;
            }
            
            nameInput.disabled = true;
            newButton.disabled = true;
            
            board.style.display = "grid";
            gameControls.style.display = "block";
            
            document.querySelector('.controls').style.display = "none";
            
            updatePlayerPosition();
            setupAutosave(); // é–‹å§‹è‡ªå‹•ä¿å­˜
        });
    }
});
        window.addEventListener('beforeunload', function(e) {
    if (!isGameOver && GameState.hasActiveGame()) {
        e.preventDefault();
        e.returnValue = 'éŠæˆ²å°šæœªçµæŸï¼Œç¢ºå®šè¦é›¢é–‹å—ï¼Ÿ';
        return e.returnValue;
    }
});
        
        loadHistory();
        createNodes();
        updatePlayerPosition();
        updateDiceFace(1);
    </script>
</body>
</html>
