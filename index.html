<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大富翁遊戲</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            background-image: url('https://png.pngtree.com/thumb_back/fh260/background/20190223/ourmid/pngtree-fresh-sweet-watercolor-soft-gradient-border-background-colorgradientsimpleframe-image_75501.jpg');
            background-size: 100vw 100vh; /* 設置圖片大小為整個視窗寬高 */
            background-repeat: no-repeat; /* 防止重複 */
            background-position: center center; /* 圖片置中 */
            background-attachment: fixed; /* 背景固定不隨滾動 */
        }
        .board {
            display: grid;
            grid-template-columns: repeat(11, minmax(30px, 1fr));
            grid-template-rows: repeat(11, minmax(30px, 1fr));
            width: 90vmin;
            height: 90vmin;
            margin: 20px;
            position: relative;
        }
        .node {
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: calc(1vw + 6px);
            background-color: #fff;
        }
        .node.corner {
            background-color: #ffdd57;
            font-weight: bold;
        }
        .node.path {
            background-color: #a5d8ff;
        }
        .player {
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 60%;
            height: 60%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        .controls, .scoreboard {
            text-align: center;
        }
        .button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .scoreboard {
            margin-top: 20px;
        }
        .scoreboard table {
            border-collapse: collapse;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        .scoreboard th, .scoreboard td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .scoreboard th {
            background-color: #007bff;
            color: white;
        }
        .question-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }
        .question-container h2 {
            margin-bottom: 20px;
        }
        .question-container button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        .question-container button.correct {
            background-color: #28a745;
            color: white;
        }
        .question-container button.incorrect {
            background-color: #dc3545;
            color: white;
        }
        .history {
            margin-top: 20px;
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        .history table {
            border-collapse: collapse;
            width: 100%;
        }
        .history th, .history td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .history th {
            background-color: #007bff;
            color: white;
        }
        .dice {
            width: 50px;
            height: 50px;
            position: relative;
            margin: 10px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .dice-face {
            width: 100%;
            height: 100%;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            position: relative;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5%;
        }
        .dot {
            width: 50%;
            height: 50%;
            background-color: #007bff;
            border-radius: 50%;
            place-self: center;
        }
        @keyframes rollDice {
            0% {
                transform: rotateX(0deg) rotateY(0deg);
            }
            25% {
                transform: rotateX(90deg) rotateY(0deg);
            }
            50% {
                transform: rotateX(90deg) rotateY(90deg);
            }
            75% {
                transform: rotateX(180deg) rotateY(90deg);
            }
            100% {
                transform: rotateX(360deg) rotateY(360deg);
            }
        }
        .dice.animate .dice-face {
            animation: rollDice 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
      .node::before {
        content: attr(data-name);
    position: absolute;
    transform: translate(-50%, -100%); /* 中心對齊節點並稍微上移 */
    left: 50%; /* 節點水平中心 */
    top: 0; /* 名稱在節點上方 */
    font-size: 12px;
    font-weight: bold;
    color: #333;
    background-color: rgba(255, 255, 255, 0.8);
    padding: 2px 5px;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    pointer-events: none; /* 避免名稱阻擋點擊事件 */
    white-space: nowrap; /* 防止文字換行 */
}
      .node {
    position: relative; /* 確保 ::before 以節點為參考點 */
}
      .node {
    margin: 5px; /* 調整節點之間的間距 */
}
      .hidden-node {
    visibility: hidden; /* 隱藏節點內容，但保留空間 */
    background-color: transparent; /* 確保背景透明 */
    border: none; /* 移除邊框 */
}
      .node[data-category="技術"] {
    background-color: #f4d03f; /* 技術 - 黃色 */
}
      .node[data-category="生活"] {
    background-color: #76d7c4; /* 生活 - 綠色 */
}
      .node[data-category="人物"] {
    background-color: #a569bd; /* 人物 - 紫色 */
}
      .node[data-category="時事"] {
    background-color: #5dade2; /* 時事 - 藍色 */
}
    </style>
</head>
<body>
    <h1>大富翁遊戲</h1>
    <div class="controls">
        <p>玩家名稱：<input type="text" id="playerName" placeholder="輸入名字" /></p>
        <button class="button" id="startGame">開始遊戲</button>
    </div>
    <div class="board" id="board" style="display: none;"></div>
    <div class="controls" style="display: none;" id="gameControls">
        <p>當前分數：<span id="score">100</span></p>
        <p>擲骰結果：<span id="diceResult">-</span></p>
        <div class="dice" id="dice">
            <div class="dice-face" id="diceFace"></div>
        </div>
        <button class="button" id="rollDice">擲骰</button>
        <button class="button" id="endGame">結算分數</button>
    </div>
    <div class="scoreboard">
        <h2>計分版</h2>
        <table>
            <thead>
                <tr>
                    <th>玩家名稱</th>
                    <th>最終分數</th>
                </tr>
            </thead>
            <tbody id="scoreboard"></tbody>
        </table>
    </div>
    <div class="history">
        <h2>遊玩紀錄</h2>
        <table>
            <thead>
                <tr>
                    <th>玩家名稱</th>
                    <th>最終分數</th>
                    <th>遊玩時間</th>
                </tr>
            </thead>
            <tbody id="history"></tbody>
        </table>
    </div>
    <div class="question-container" id="questionContainer">
        <h2 id="questionText">問題</h2>
        <div id="options"></div>
    </div>
    <script>
        const board = document.getElementById('board');
        const gameControls = document.getElementById('gameControls');
        const scoreDisplay = document.getElementById('score');
        const diceResultDisplay = document.getElementById('diceResult');
        const rollDiceButton = document.getElementById('rollDice');
        const endGameButton = document.getElementById('endGame');
        const playerNameInput = document.getElementById('playerName');
        const startGameButton = document.getElementById('startGame');
        const scoreboardTable = document.getElementById('scoreboard');
        const historyTable = document.getElementById('history');
        const questionContainer = document.getElementById('questionContainer');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('options');
        const diceFace = document.getElementById('diceFace');

        let playerScore = 100;
        let playerPosition = 0;
        let totalNodesTravelled = 0;
        let playerName = "";
        const totalNodes = 36;
        const questions = {
        技術: [
        { text: "HTML 是什麼的縮寫？", options: ["Hyper Text Markup Language", "Hyperlink and Text Module", "Home Tool Markup Language"], answer: "Hyper Text Markup Language" },
        { text: "JavaScript 是一種什麼語言？", options: ["靜態語言", "動態語言", "標記語言"], answer: "動態語言" },
        ],
        生活: [
        { text: "早餐不吃會對身體造成什麼影響？", options: ["增加新陳代謝", "降低血糖", "沒有影響"], answer: "降低血糖" },
        ],
        人物: [
        { text: "愛因斯坦最著名的理論是什麼？", options: ["量子力學", "相對論", "熱力學"], answer: "相對論" },
        ],
        時事: [
        { text: "2025 年世界的最新科技趨勢是什麼？", options: ["人工智慧", "量子計算", "區塊鏈"], answer: "人工智慧" },
        ],
    };
        const loadHistory = () => {
            try {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];
                historyTable.innerHTML = "";
                history.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${record.name}</td><td>${record.score}</td><td>${record.time}</td>`;
                    historyTable.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading history: ", error);
            }
        };

        const saveToHistory = (name, score) => {
            try {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];
                const time = new Date().toLocaleString();
                history.push({ name, score, time });
                localStorage.setItem('gameHistory', JSON.stringify(history));
            } catch (error) {
                console.error("Error saving to history: ", error);
            }
        };

        startGameButton.addEventListener('click', () => {
            playerName = playerNameInput.value.trim();
            if (!playerName || playerName.length > 20 || /[^a-zA-Z0-9一-龥]/.test(playerName)) {
                alert("請輸入有效的名字（20 字以內，僅包含字母、數字或中文）！");
                return;
            }
            playerNameInput.disabled = true;
            startGameButton.disabled = true;
            board.style.display = "grid";
            gameControls.style.display = "block";
            updatePlayerPosition();
        });


        const createNodes = () => {
    for (let i = 0; i < 11; i++) {
        for (let j = 0; j < 11; j++) {
            const node = document.createElement('div');
            const isEdge = (i === 0 || i === 10 || j === 0 || j === 10);
            const isCorner = (i === 0 && j === 0) || (i === 0 && j === 10) || 
                             (i === 10 && j === 0) || (i === 10 && j === 10);

            if (isCorner) {
                node.classList.add('node', 'corner');
                node.dataset.name = '特殊角落';
            } else if (isEdge) {
                node.classList.add('node', 'path');
                const nodeIndex = calculateNodeIndex(i, j);
                const categoryNames = ['技術', '生活', '人物', '時事'];
                node.dataset.category = categoryNames[nodeIndex % 4];
                node.dataset.name = categoryNames[nodeIndex % 4];
                node.dataset.index = nodeIndex; // 設置節點編號
            } else {
                node.classList.add('node');
            }

            board.appendChild(node);
        }
    }
};

        function calculateNodeIndex(row, col) {
            if (row === 0) return col;
            if (col === 10) return 10 + row;
            if (row === 10) return 30 - col;
            if (col === 0) return 30 + (10 - row);
            return null;
        }

        function updatePlayerPosition() {
            const nodes = document.querySelectorAll('.node');
            nodes.forEach(node => node.innerHTML = "");
            const currentNode = [...nodes].find(node => node.dataset.index == playerPosition);
            if (currentNode) {
                const playerElement = document.createElement('div');
                playerElement.classList.add('player');
                playerElement.textContent = "P";
                currentNode.appendChild(playerElement);
            }
        }

        function updateDiceFace(value) {
            const dots = [
                [],
                [4],
                [0, 8],
                [0, 4, 8],
                [0, 2, 6, 8],
                [0, 2, 4, 6, 8],
                [0, 2, 3, 5, 6, 8]
            ];
            diceFace.innerHTML = "";
            for (let i = 0; i < 9; i++) {
                const dot = document.createElement('div');
                dot.className = dots[value].includes(i) ? 'dot' : '';
                diceFace.appendChild(dot);
            }
        }

        rollDiceButton.addEventListener('click', () => {
            diceFace.classList.add('animate');
            rollDiceButton.disabled = true;
            endGameButton.disabled = true;

            const diceResult = Math.floor(Math.random() * 6) + 1;

            let rollingInterval = setInterval(() => {
                const randomValue = Math.floor(Math.random() * 6) + 1;
                updateDiceFace(randomValue);
            }, 100);

            setTimeout(() => {
                clearInterval(rollingInterval);
                diceFace.classList.remove('animate');
                updateDiceFace(diceResult);
                diceResultDisplay.textContent = diceResult;
                rollDiceButton.disabled = false;
                endGameButton.disabled = false;

                totalNodesTravelled += diceResult;
                playerPosition = (playerPosition + diceResult) % totalNodes;
                updatePlayerPosition();
                askQuestion(playerPosition);
            }, 1000);
        });

        function askQuestion(position) {
    // 找到當前節點
    const nodes = document.querySelectorAll('.node');
    const currentNode = [...nodes].find(node => node.dataset.index == position);

    if (!currentNode) {
        console.error("無法找到當前節點，位置：", position);
        return;
    }

    // 獲取節點類別並找到題目
    const category = currentNode.dataset.category;
    const questionPool = questions[category];
    if (!questionPool || questionPool.length === 0) {
        console.error("無題目可用，分類：", category);
        return;
    }

    // 隨機選擇題目
    const questionIndex = Math.floor(Math.random() * questionPool.length);
    const question = questionPool[questionIndex];

    // 更新問題容器內容
    questionText.textContent = question.text;
    optionsContainer.innerHTML = "";

    question.options.forEach(option => {
        const button = document.createElement('button');
        button.textContent = option;
        button.addEventListener('click', () => {
            handleAnswer(option === question.answer);
        });
        optionsContainer.appendChild(button);
    });

    // 顯示問題容器
    questionContainer.style.display = "block";

    // 禁用骰子按鈕，直到玩家回答問題
    rollDiceButton.disabled = true;
    endGameButton.disabled = true;
}
      function handleAnswer(isCorrect) {
    if (isCorrect) {
        alert("答對了！加10分！");
        playerScore += 10;
    } else {
        alert("答錯了！扣10分！");
        playerScore -= 10;
    }

    // 更新分數顯示
    scoreDisplay.textContent = playerScore;

    // 隱藏問題容器
    questionContainer.style.display = "none";

    // 重新啟用骰子按鈕
    rollDiceButton.disabled = false;
    endGameButton.disabled = false;

    // 遊戲結束條件
    if (playerScore <= 0) {
        alert("遊戲結束！分數歸零！");
        rollDiceButton.disabled = true;
        endGameButton.disabled = true;
    }
}

        endGameButton.addEventListener('click', () => {
            const weightedScore = totalNodesTravelled * 2;
            const finalScore = playerScore + weightedScore;

            const newRow = document.createElement('tr');
            newRow.innerHTML = `<td>${playerName}</td><td>${finalScore}</td>`;
            scoreboardTable.appendChild(newRow);

            saveToHistory(playerName, finalScore);

            alert(`遊戲結束！\n答題分數：${playerScore}\n行經節點分數：${weightedScore}\n最終分數：${finalScore}`);
            rollDiceButton.disabled = true;
            endGameButton.disabled = true;
        });

        loadHistory();
        createNodes();
        updatePlayerPosition();
        updateDiceFace(1);
    </script>
</body>
</html>
